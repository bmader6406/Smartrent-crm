<% 
  hylet = @campaign.first_nlt_hylet
%>
<div class="campaign-info">
  <div class="crud-buttons">
    <table>
      <tr>
        <td>
          <%= link_to("Edit", edit_property_campaign_path(@property, @campaign), :class => "btn btn-lg btn-primary") %>
        </td>
        <td>
          <%= link_to("Preview", preview_property_campaign_path(@property, @campaign), :class => "btn btn-lg btn-default", :target => "_blank") %>
        </td>
      </tr>
    </table>
  </div>
  
  <div class="card">
    <h3> Notice Info </h3>
    <ul class="list-unstyled">
      <li>
        <b>Subject:</b> <%= hylet.subject %>
      </li>
      <li>
        <b>From:</b> <%= hylet.from %>
      </li>
      <li>
        <b>To:</b> 
        <%= 
          cache_audiences = @campaign.multi_sends.collect{|s| s.audience_counts }.flatten.compact.uniq

          if @campaign.nlt_clzz? && cache_audiences.length > 0
            audiences = Audience.where(:id => cache_audiences.collect{|a| a["id"]}).includes(:property, :campaign).all

            cache_audiences.collect{|c|
              a = audiences.detect{|a| a.id == c["id"].to_i}

              if a #existing
                a.long_name

              else #deleted audience
                property = Property.find_by_id(c["property_id"])

                if property
                  "#{property.name} #{c["name"]}"
                else
                  c["name"]
                end

              end
            }.join(', ')

          else
            @campaign.first_nlt_hylet.audiences.collect{|a| a.long_name }.join(', ')
          end
        %>
      </li>
      <li>
        <b>Sent At:</b> <%= @campaign.sent_at %>
      </li>
    </ul>
  </div>
</div>